# Î∞∞Ìè¨ Í∞ÄÏù¥Îìú

# üîé Stacks

### Management Tool

`Jira` `Mattermost` `Discord` `Notion` `GitLab` `Figma` `ERDCloud`

### IDE

`VSCode` `Intellij`

### Infra

`Amazon S3(1.12.529)` `Nginx(1.18.0)` `Docker(25.0.4)` `Ubuntu(20.04.6)` `EC2` `Logstash(8.12.2)` `Kibana(8.12.2)` `Sonarqube(9.9.4)` `Jenkins(2.450)`

### Frontend

`HTML5` `CSS` `JS` `React(18.2.0)` `Axios(1.6.8)` `React-Router-Dom(6.22.3)` `Node(20.11.1)` `React-Dom(18.2.0)` `Zustand(4.5.2)` `Styled-Components(6.1.8)` 

### Backend

`Java(17)` `Spring boot(3.2.3)` `Spring Date JPA(3.2.3)` `jjwt(0.12.5)` `QueryDsl(5.0.0)` `Mysql(8.0)` `Redis(7.2.4)` `Elasticsearch(8.12.2)`

### Data

`Python(3.11)` `FastAPI(0.110.0)` `uvicorn(0.29.0)` `tensorflow(2.15.0)` `konply(0.6.0)` `pandas(2.2.1)` `numpy(1.26.4)` `scikit-learn(1.12.0)` `jupyter hub(4.0.2)`

# üóÉÔ∏è Build & Distribute

## Backend Build

### application.yml

```
spring:
  datasource:
    driver-class-name: {DB Driver}
    url: {DB URL}
    username: {DB username}
    password: {DB password}
    hikari:
      maximum-pool-size: {Pool SIze}
  jpa:
    hibernate:
      ddl-auto: update
    defer-datasource-initialization: true
  sql:
    init:
      mode: always
  servlet:
    multipart:
      max-file-size: {ÏóÖÎ°úÎìú Ïö©Îüâ Ï†úÌïú}
      max-request-size: {ÏóÖÎ°úÎìú Ïö©Îüâ Ï†úÌïú}
  jackson:
    time-zone: {ÌÉÄÏûÑÏ°¥ ÏÑ∏ÌåÖ}

  jwt:
    header: {JWT hearder ÏÑ∏ÌåÖ}
    secret: {JWT Secret ÏÑ∏ÌåÖ}
    access-token-validity-in-seconds: {access token Ïú†Ìö®Í∏∞Í∞Ñ ÏÑ§Ï†ï}
    refresh-token-validity-in-seconds: {refresh token Ïú†Ìö®Í∏∞Í∞Ñ ÏÑ§Ï†ï}
  elasticsearch:
    uris: {Elascitsearech URL}
    password: {Elasticsearch password}
    username: {Elasticsearch username}

redis:
  master:
    host: {Redis URL}
    port: {Redis port}
  password: {Redis password}

server:
  port: {Server port}
  servlet:
    context-path: {Server context path}

management:
  endpoints:
    enabled-by-default: false
  endpoint:
    health:
      enabled: true

kakao:
  api:
    secret: {kakao REST api key}
  login:
    secret: {kakao REST api key}
    redirect: {kakao login redirect URL}
    tmp-path: {kakao login tmp-path}
swagger:
  local: {swagger local URL}
  production: {swagger production URL}

feign :
  fast-api:
    url: {fast-api URL}
  kakao:
    token: {kakao token URL}
    authorize: {kakao authorize URL}
    user: {kakao user URL}

cloud:
  aws:
    s3:
      bucket: {bucket name}
    credentials:
      access-key: {aws s3 credentials access-key}
      secret-key: {aws s3 credentials secret-key}
    region:
      static: {aws s3 region}
      auto: false
    stack:
      auto: false
    prefix: {aws s3 bucket URL}

default:
  profile:
    image:
      url: {default profile image url}

```

### IDE Î∞è ÌôòÍ≤ΩÏÑ§Ï†ï

```
1. jdk 17 Îã§Ïö¥Î°úÎìú Î∞è ÌôòÍ≤ΩÎ≥ÄÏàò ÏÑ§Ï†ï
2. git clone ÌõÑ backend Ìè¥ÎçîÎ•º IntellijÏóêÏÑú OpenÌïòÏó¨ Í∞ÄÏ†∏Ïò§Í∏∞
3. Intellij - File - Project Structure - ProjectÏóêÏÑú SDKÎ•º 17Î≤ÑÏ†ÑÏúºÎ°ú ÎßûÏ∂îÍ∏∞
4. Intellij - File - Settings - GradleÏóêÏÑú Gradle JVMÏùÑ [1]ÏóêÏÑú Ï∂îÍ∞ÄÌïú ÌôòÍ≤ΩÎ≥ÄÏàòÎ°ú ÏßÄÏ†ï
5. Intellij Ïö∞Ï∏° Gradle ÌÅ¥Î¶≠ ÌõÑ ÏÉàÎ°úÍ≥†Ïπ®
6. Intellij - Run - GitherbsApplicationÏúºÎ°ú Ïã§Ìñâ
```

### Dockerfile (Back)

```docker
FROM openjdk:17-jdk
ADD ./build/libs/githerbs-0.0.1-SNAPSHOT.jar app.jar
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

---

## Frontend Build

### .env

```
VITE_NAVER_CLIENT_KEY={Naver Map APIÏùò Client ID}
```

### IDE Î∞è ÌôòÍ≤ΩÏÑ§Ï†ï

```
1. Node.js 20.11.1 Îã§Ïö¥Î°úÎìú Î∞è ÌôòÍ≤ΩÎ≥ÄÏàò ÏÑ§Ï†ï
2. git clone ÌõÑ frontend Ìè¥ÎçîÎ•º vscodeÏóêÏÑú OpenÌïòÏó¨ Í∞ÄÏ†∏Ïò§Í∏∞
3. npm install
5. frontend Ìè¥Îçî ÏÉÅÏúÑ Í≤ΩÎ°úÏóê .env ÌååÏùº ÏúÑÏπòÏãúÌÇ§Í∏∞
6. npm run build
```

### Dockerfile (Front)

```docker
# Î≤†Ïù¥Ïä§ Ïù¥ÎØ∏ÏßÄÎ°ú Nginx ÏÇ¨Ïö©
FROM nginx:stable-alpine

# Nginx ÏÑ§Ï†ï ÌååÏùº Î≥µÏÇ¨
COPY nginx.conf /etc/nginx/conf.d/default.conf

# JenkinsÏóêÏÑú ÎπåÎìúÎêú Í≤∞Í≥ºÎ¨ºÏùÑ NginxÏùò Ï†ïÏ†Å ÌååÏùº ÎîîÎ†âÌÜ†Î¶¨Î°ú Î≥µÏÇ¨
COPY ./dist /usr/share/nginx/html

# Ìè¨Ìä∏ ÎÖ∏Ï∂ú
EXPOSE 80

# Ïª®ÌÖåÏù¥ÎÑà Ïã§Ìñâ Ïãú Nginx ÏãúÏûë
CMD ["nginx", "-g", "daemon off;"]

```

### **.dockerignore** (Front)

```docker
node_modules
npm-debug.log
build
```

---

## Data Build

### Ï∂îÏ≤ú ÏïΩÏ¥à ÏÑúÎ≤Ñ Î∞∞Ìè¨

### IDE Î∞è ÌôòÍ≤ΩÏÑ§Ï†ï (ÏúàÎèÑÏö∞ ÌôòÍ≤Ω)

```
# ÌååÏù¥Ïç¨ ÏÑ§Ïπò
1. python (3.11) ÏÑ§Ïπò ÌõÑ ÌôòÍ≤ΩÎ≥ÄÏàò ÏÑ§Ï†ï

# ÌååÏù¥Ïç¨ Í∞ÄÏÉÅÌôòÍ≤Ω ÏÑ§Ï†ï
1. Í∞ÄÏÉÅÌôòÍ≤Ω ÏÑ§Ï†ïÌï† Ìè¥Îçî ÏÉùÏÑ±
2. Ìè¥ÎçîÏóêÏÑú python -m venv Í∞ÄÏÉÅÌôòÍ≤ΩÏù¥Î¶Ñ Ïã§Ìñâ

# ÌååÏù¥Ïç¨ Í∞ÄÏÉÅÌôòÍ≤Ω ÏßÑÏûÖ
1. Í∞ÄÏÉÅÌôòÍ≤ΩÏïàÏóê ÏûàÎäî ScriptÏóêÏÑú activate Î™ÖÎ†πÏñ¥ Ïã§Ìñâ
  (Í∞ÄÏÉÅÌôòÍ≤ΩÏóêÏÑú Î≤óÏñ¥ÎÇòÍ≥† Ïã∂ÏùÄ Í≤ΩÏö∞Îäî Í∞ôÏùÄ Ìè¥ÎçîÏóêÏÑú deactivate Ïã§Ìñâ)
2. Î™ÖÎ†π ÌîÑÎ°¨Ìè¨Ìä∏ ÏôºÏ™ΩÏóê (Í∞ÄÏÉÅÌôòÍ≤ΩÏù¥Î¶Ñ) Ïù¥ Î∂ôÏñ¥ ÏûàÏúºÎ©¥ ÏßÑÏûÖ ÏôÑÎ£å

# ÎùºÏù¥Î∏åÎü¨Î¶¨ ÏÑ§Ïπò
1. git clone ÏùÑ ÌÜµÌï¥ Î∞õÏùÄ ÌååÏùº Ï§ëÏóêÏÑú requirements.txt ÏûàÎäî Ìè¥ÎçîÎ°ú Ïù¥Îèô
2. pip install -r requirements.txt Î™ÖÎ†πÏñ¥Î•º ÌÜµÌï¥ ÌïÑÏöîÌïú ÎùºÏù¥Î∏åÎü¨Î¶¨ ÏÑ§Ïπò
  (pip freeze > requirements.txt ÏùÄ Îã§Ïö¥Î∞õÏùÄ ÎùºÏù¥Î∏åÎü¨Î¶¨ Î™©Î°ù txtÎ°ú Ï†ÄÏû•)
 
# fastapi Ïã§Ìñâ
1. main.py Í∞Ä ÏûàÎäî Ìè¥ÎçîÎ°ú Ïù¥Îèô
2. uvicorn main:app --reload Î°ú fastapi Ïã§Ìñâ
```

### Dockerfile

```
FROM python:3.12.2

# JDK ÏÑ§Ïπò
RUN apt-get update && \
    apt-get install -y default-jdk && \
    apt-get clean

# JAVA_HOME ÌôòÍ≤Ω Î≥ÄÏàò ÏÑ§Ï†ï
ENV JAVA_HOME /usr/lib/jvm/default-java
RUN export JAVA_HOME

WORKDIR /code

COPY ./requirements.txt /code/requirements.txt

RUN pip install --no-cache-dir --upgrade -r /code/requirements.txt

COPY ./main.py /code/
COPY ./recommender.py /code/
COPY herb_medicinal_effect.csv /code/

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "80"]
```

### Docker Ïã§Ìñâ

```
# Ïù¥ÎØ∏ÏßÄ Îã§Ïãú ÎπåÎìúÌïòÍ∏∞
docker build -t **Ïù¥ÎØ∏ÏßÄ Ïù¥Î¶Ñ** .

# ÎπåÎìú Ìïú Ïù¥ÎØ∏ÏßÄ Ïã§Ìñâ
docker run --name **Ïª®ÌÖåÏù¥ÎÑàÏù¥Î¶Ñ** -d -p **ec2ÏóêÏÑúÏ†ëÏÜçÌï†Ìè¨Ìä∏**:**DockerfileÏóêÏ†ÅÌûåÌè¨Ìä∏** **Ïù¥ÎØ∏ÏßÄÏù¥Î¶Ñ**

# Ïª®ÌÖåÏù¥ÎÑà Î°úÍ∑∏ ÌôïÏù∏
docker logs **Ïª®ÌÖåÏù¥ÎÑàÏù¥Î¶Ñ**
```

### Ïù¥ÎØ∏ÏßÄ Í≤ÄÏÉâ ÏÑúÎ≤Ñ

### ngrok ÏÑ§Ï†ï

```powershell
1. ngrok ÌöåÏõê Í∞ÄÏûÖ ÌõÑ auth token Î∞úÍ∏â
https://dashboard.ngrok.com/get-started/your-authtoken

2. ngrok ÌîÑÎ°úÍ∑∏Îû® Îã§Ïö¥Î°úÎìú(ÌôàÌéòÏù¥ÏßÄ Ï∞∏Í≥†) + ÌïÑÏöîÌïú Í≤ΩÏö∞ path ÏÑ§Ï†ï

3. ngrok ÌîÑÎ°úÍ∑∏Îû®Ïóê auth token ÏûÖÎ†•
ngrok config add-authtoken {your-auth-token}

4. ngrok Ïã§Ìñâ
ngrok http {your-port}

5. ÏΩòÏÜî Ï∞ΩÏóê Ï∂úÎ†•ÎêòÎäî urlÎ°ú Ïô∏Î∂Ä Ï†ëÏÜç Í∞ÄÎä•
```

### Ïù¥ÎØ∏ÏßÄ Í≤ÄÏÉâ ÏÑúÎ≤Ñ Î∞∞Ìè¨ Î∞©Î≤ï

```powershell
1. docker ÏÑ§Ïπò

2. ÏΩòÏÜî Ï∞ΩÏóê nvidia-smi Î™ÖÎ†πÏñ¥ ÏûÖÎ†•Ìï¥ ÏßÄÏõêÍ∞ÄÎä•Ìïú CUDA Î≤ÑÏ†Ñ ÌôïÏù∏

3. tensorflow ÏÇ¨Ïù¥Ìä∏ÏóêÏÑú Î≥∏Ïù∏Ïùò CUDA Î≤ÑÏ†ÑÏóê ÎßûÎäî tensorflow Î≤ÑÏ†Ñ ÌôïÏù∏
https://www.tensorflow.org/install/source#gpu

4. docker hubÏóêÏÑú Î≥∏Ïù∏Ïùò tensorflow Î≤ÑÏ†ÑÏóê ÎßûÎäî Ïù¥ÎØ∏ÏßÄ Ï§ë gpu ÌÉúÍ∑∏Í∞Ä ÏûàÎäî Ïù¥ÎØ∏ÏßÄ Ïù¥Î¶Ñ ÌôïÏù∏
https://hub.docker.com/r/tensorflow/tensorflow/tags
ex) tensorflow/tensorflow:2.16.1-gpu-jupyter

5. git clone ÌõÑ, data/docker-compose.yml ÌååÏùºÏ§ë tensorflow: -> image: Î∂ÄÎ∂ÑÏùÑ Î≥∏Ïù∏ÏóêÍ≤å ÎßûÎäî tensorflow Î≤ÑÏ†ÑÏúºÎ°ú Î≥ÄÍ≤Ω
# docker-compose.yml
version: "3"
services:
    tensorflow:
        image: tensorflow/tensorflow:{your-tensorflow-version-with-gpu}

6.ÏΩòÏÜî Ï∞ΩÏóêÏÑú docker-compose.ymlÌååÏùºÏù¥ ÏûàÎäî ÎîîÎ†âÌÜ†Î¶¨Î°ú Ïù¥Îèô ÌõÑ, docker-compose up ÏûÖÎ†•Ìï¥ ÏÑúÎ≤Ñ Í∞ÄÎèô

7.Î™®Îç∏ Î°úÎî© ÏóêÎü¨ Î∞úÏÉù Ïãú, notebook/outputÏóêÏÑú Î™®Îç∏ ÏïïÏ∂ï ÌååÏùºÏùÑ /model Í≤ΩÎ°úÏóê Ìï¥Ï†úÌïú ÌõÑ Îã§Ïãú ÏÑúÎ≤Ñ Í∞ÄÎèô
```

## Î∞∞Ìè¨ ÌååÏùº Ìè¥Îçî Íµ¨Ï°∞

```
üì¶githerbs
 ‚î£ üìÇdomain
 ‚îÉ ‚î£ üìÇauth
 ‚îÉ ‚îÉ ‚î£ üìÇcontroller
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇcommon
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇrequest
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚îÉ ‚î£ üìÇentity
 ‚îÉ ‚îÉ ‚î£ üìÇrepository
 ‚îÉ ‚îÉ ‚îó üìÇservice
 ‚îÉ ‚î£ üìÇboard
 ‚îÉ ‚îÉ ‚î£ üìÇcontroller
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇrequest
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚îÉ ‚î£ üìÇentity
 ‚îÉ ‚îÉ ‚î£ üìÇrepository
 ‚îÉ ‚îÉ ‚îó üìÇservice
 ‚îÉ ‚î£ üìÇevent
 ‚îÉ ‚îÉ ‚î£ üìÇcontroller
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇrequest
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚îÉ ‚î£ üìÇentity
 ‚îÉ ‚îÉ ‚î£ üìÇrepository
 ‚îÉ ‚îÉ ‚îó üìÇservice
 ‚îÉ ‚î£ üìÇherb
 ‚îÉ ‚îÉ ‚î£ üìÇcontroller
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇrequest
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚îÉ ‚î£ üìÇentity
 ‚îÉ ‚îÉ ‚î£ üìÇrepository
 ‚îÉ ‚îÉ ‚îó üìÇservice
 ‚îÉ ‚î£ üìÇmanual
 ‚îÉ ‚îÉ ‚î£ üìÇcontroller
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚îÉ ‚î£ üìÇentity
 ‚îÉ ‚îÉ ‚î£ üìÇrepository
 ‚îÉ ‚îÉ ‚îó üìÇservice
 ‚îÉ ‚î£ üìÇmember
 ‚îÉ ‚îÉ ‚î£ üìÇcontroller
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇcommon
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇrequest
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚îÉ ‚î£ üìÇentity
 ‚îÉ ‚îÉ ‚î£ üìÇrepository
 ‚îÉ ‚îÉ ‚îó üìÇservice
 ‚îÉ ‚îó üìÇsearch
 ‚îÉ ‚îÉ ‚î£ üìÇcontroller
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚îÉ ‚î£ üìÇentity
 ‚îÉ ‚îÉ ‚î£ üìÇrepository
 ‚îÉ ‚îÉ ‚îó üìÇservice
 ‚î£ üìÇglobal
 ‚îÉ ‚î£ üìÇcommon
 ‚îÉ ‚îÉ ‚î£ üìÇcode
 ‚îÉ ‚îÉ ‚î£ üìÇexception
 ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚î£ üìÇconfig
 ‚îÉ ‚îó üìÇhandler
 ‚îó üìúGitherbsApplication.java

```

```
üì¶frontend
 ‚î£ üìÇpublic
 ‚îÉ ‚î£ üìÇgrass
 ‚îÉ ‚î£ üìÇherbs
 ‚îÉ ‚î£ üìÇpediaimg
 ‚îÉ ‚î£ üìÇprofileimg
 ‚î£ üìÇsrc
 ‚îÉ ‚î£ üìÇapis
 ‚îÉ ‚î£ üìÇassets
 ‚îÉ ‚îÉ ‚î£ üìÇfonts
 ‚îÉ ‚î£ üìÇcomponents
 ‚îÉ ‚îÉ ‚î£ üìÇboard
 ‚îÉ ‚îÉ ‚î£ üìÇescape
 ‚îÉ ‚îÉ ‚î£ üìÇherbdetail
 ‚îÉ ‚îÉ ‚î£ üìÇmain
 ‚îÉ ‚îÉ ‚î£ üìÇmypage
 ‚îÉ ‚îÉ ‚î£ üìÇpedia
 ‚îÉ ‚îÉ ‚î£ üìÇpicture
 ‚îÉ ‚îÉ ‚î£ üìÇsearch
 ‚îÉ ‚î£ üìÇpages
 ‚îÉ ‚î£ üìÇstore
 ‚îÉ ‚î£ üìÇutils

```

```
üì¶data
 ‚î£ üìÇimage
 ‚îÉ ‚î£ üìÇmodel
 ‚îÉ ‚î£ üìÇnotebook
 ‚îÉ ‚îÉ ‚î£ üìÇoutput
 ‚î£ üìÇsearch
```

# ‚öôÔ∏è Server Settings

## MobaXterm

- MobaXtermÏùÑ ÌÜµÌï¥ EC2 ÏÑúÎ≤ÑÏóê Ï†ëÏÜç

```
1. Ï¢åÏ∏° ÏÉÅÎã®Ïùò Session - SSH ÌÅ¥Î¶≠
2. ÌïÑÏöî Ï†ïÎ≥¥ ÏûÖÎ†•
	- 1. Remote Host: EC2 Domain ÏûÖÎ†•
	- 2. Specify username: Ï≤¥ÌÅ¨ ÌõÑ ubuntu ÏûÖÎ†•
3. Advanced SSH settings ÌÉ≠ ÌÅ¥Î¶≠
4. ÌïÑÏöî Ï†ïÎ≥¥ ÏûÖÎ†•
	- 1. Use private key Ï≤¥ÌÅ¨ ÌõÑ .pem ÌååÏùº Ï≤®Î∂Ä
5. Bookmark settings - Session nameÏóêÏÑú ÏõêÌïòÎäî ÏÑúÎ≤Ñ Ïù¥Î¶Ñ ÏûÖÎ†•
```

## Server Default Setting

- ÌïúÍµ≠ ÌëúÏ§ÄÏãúÎ°ú Î≥ÄÍ≤Ω

```bash
sudo timedatectl set-timezone Asia/Seoul
```

- Ìå®ÌÇ§ÏßÄ Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏ Î∞è Ìå®ÌÇ§ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏

```bash
sudo apt-get -y update && sudo apt-get -y upgrade
```

## Docker Setting

- Docker ÏÑ§Ïπò Ï†Ñ ÌïÑÏöîÌïú Ìå®ÌÇ§ÏßÄ ÏÑ§Ïπò

```bash
sudo apt-get -y install apt-transport-https ca-certificates curl gnupg-agent software-properties-common
```

- amd / arm ÌôïÏù∏

```bash
dpkg -s libc6 | grep Arch
```

- ÏúÑÏóê Ìï¥ÎãπÌïòÎäî Í≥ÑÏó¥Î°ú Docker Î†àÌè¨ÏßÄÌÜ†Î¶¨ Îì±Î°ù
ÏûÑÏùòÎ°ú amd / arm ‚áí verÎ°ú ÏûëÏÑ±

```bash
sudo add-apt-repository "deb [arch=ver64] https://download.docker.com/linux/ubuntu$(lsb_release -cs) stable"
```

- Ìå®ÌÇ§ÏßÄ Î¶¨Ïä§Ìä∏ Í∞±Ïã†

```bash
sudo apt-get -y update
```

- Docker Ìå®ÌÇ§ÏßÄ ÏÑ§Ïπò

```bash
sudo apt-get -y install docker-ce docker-ce-cli containerd.io
```

- Docker ÏÑúÎπÑÏä§ Ïû¨ÏãúÏûë

```bash
sudo service docker restart
exit
```

## SSL Setting

- nginxÎ•º ÏÑ§Ïπò

```bash
sudo apt-get -y install nginx
```

- CertBot Îã§Ïö¥Î°úÎìú

```bash
sudo snap install --classic certbot
```

- SSL Ïù∏Ï¶ùÏÑú Î∞úÍ∏â

```bash
sudo nginx --nginx -d my.domain.com
Ïù¥ÌõÑÏóê Ïù¥Î©îÏùº Ï£ºÏÜå ÏûÖÎ†•
```

## NginX Setting

- NginX HTTP Î∞©ÌôîÎ≤Ω ÌóàÏö©

```bash
sudo ufw app list
sudo ufw allow 'Nginx HTTP'
sudo ufw enable
```

- NginX Ïû¨ÏãúÏûë Î∞è ÏÉÅÌÉú ÌôïÏù∏

```bash
sudo service nginx restart
sudo service nginx status
```

- default ÏÑ§Ï†ï Ìé∏Ïßë
    - proxy_pass Í≤ΩÎ°úÎ•º ÏßÄÏ†ïÌïòÍ∏∞ ÏúÑÌï¥ url Ï∂îÍ∞Ä

```bash
sudo vim /etc/nginx/sites-enabled/default
====> ÏïÑÎûò ÎÇ¥Ïö© Ï∂îÍ∞Ä
include /etc/nginx/conf.d/service-url.inc;
include /etc/nginx/conf.d/client-url.inc;
====> location / ÏïàÏóê ÏÑ§Ï†ï
proxy_pass $client_url;
====> location /api ÏïàÏóê ÏÑ§Ï†ï
proxy_pass $service_url;
```

- service-url.inc Ï∂îÍ∞Ä

```bash
sudo vim /etc/nginx/conf.d/service-url.inc
====> ÏïÑÎûò ÎÇ¥Ïö© Ï∂îÍ∞Ä
set $service_url http://127.0.0.1:{Î∞±ÏóîÎìú Ìè¨Ìä∏Î≤àÌò∏};
```

- client-url.inc Ï∂îÍ∞Ä

```bash
sudo vim /etc/nginx/conf.d/client-url.inc
====> ÏïÑÎûò ÎÇ¥Ïö© Ï∂îÍ∞Ä
set $client_url http://127.0.0.1:{ÌîÑÎ°†Ìä∏ÏóîÎìú Ìè¨Ìä∏Î≤àÌò∏};
```

- Ï∂îÍ∞Ä ÌõÑ nginx Ïû¨ÏãúÏûë

## Mysql & Redis

```yaml
version: '3.1'
services:
  mysql:
    image: mysql:8.0
    container_name: mysql
    ports:
      - 3306:3306 # HOST:CONTAINER
    environment:
      MYSQL_ROOT_PASSWORD: {mysql-password}
    command:
      - --character-set-server=utf8mb4
      - --collation-server=utf8mb4_unicode_ci
    volumes:
      - /home/ubuntu/docker-compose/mysql/mysql:/var/lib/mysql
    restart: always
  
  redis:
    image: redis
    container_name: redis
    ports:
      - 6379:6379
    volumes:
      - /home/ubuntu/docker-compose/redis/data:/data
      - /home/ubuntu/docker-compose/redis/redis:/usr/local/etc/redis
    command: redis-server /usr/local/etc/redis/redis.conf
```

- [https://raw.githubusercontent.com/redis/redis/7.2/redis.conf](https://raw.githubusercontent.com/redis/redis/7.2/redis.conf) Ï†ëÏÜç ÌõÑ ÌååÏùº Îã§Ïö¥Î°úÎìú, ÏàòÏ†ï

```
# redis.conf
bind 127.0.0.1 -::1 -> bind * -::*
requirepass ->  {Î†àÎîîÏä§ ÎπÑÎ∞ÄÎ≤àÌò∏}
```

## ELK(Elasticsearch, Logstash, Kibana)

- ÌååÏùº Îã§Ïö¥Î°úÎìú

```
1. [https://letsencrypt.org/certs/isrgrootx1.pem](https://letsencrypt.org/certs/isrgrootx1.pem) Ìï¥Îãπ ÌååÏùºÏùÑ Îã§Ïö¥Î°úÎìú Î∞õÎäîÎã§
2. [https://github.com/deviantony/docker-elk](https://github.com/deviantony/docker-elk) Ï†ëÏÜç ÌõÑ ÌÅ¥Î°†ÏùÑ Î∞õÎäîÎã§.
```

- docker-compose.yml ÏàòÏ†ï

```
1. ÌÅ¥Î°†ÏùÑ Î∞õÏùÄ ÌõÑ docker-compose.yml ÌååÏùºÏùò setupÏ§ë depends_on Î∂ÄÎ∂ÑÏóê ÏïÑÎûò ÎÇ¥Ïö© ÏûëÏÑ±
	    depends_on:
      - elasticsearch
      - kibana
      - logstash
      
2. elasticsearchÏ§ë volumesÏóê Ï∂îÍ∞Ä
    volumes:
      - ./elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro,Z
      - ./elasticsearch/config/privkey.pem:/usr/share/elasticsearch/config/privkey.pem:ro,Z
      - ./elasticsearch/config/fullchain.pem:/usr/share/elasticsearch/config/fullchain.pem:ro,Z
      - ./elasticsearch/config/chain.pem:/usr/share/elasticsearch/config/chain.pem:ro,Z
      - ./elasticsearch/config/user_dict.txt:/usr/share/elasticsearch/config/user_dict.txt:ro,Z
      - ./elasticsearch/config/synonyms.txt:/usr/share/elasticsearch/config/synonyms.txt:ro,Z
      - elasticsearch:/usr/share/elasticsearch/data:Z
      
3. logstashÏ§ë volumesÏóê Ï∂îÍ∞Ä
    volumes:
      - ./logstash/config/logstash.yml:/usr/share/logstash/config/logstash.yml:ro,Z
      - ./logstash/pipeline:/usr/share/logstash/pipeline:ro,Z
      - ./logstash/config/privkey.pem:/usr/share/logstash/config/privkey.pem:ro,Z
      - ./logstash/config/fullchain.pem:/usr/share/logstash/config/fullchain.pem:ro,Z
      - ./logstash/config/chain.pem:/usr/share/logstash/config/chain.pem:ro,Z
      
4. kibanaÏ§ë volumesÏóê Ï∂îÍ∞Ä
    volumes:
      - ./kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml:ro,Z
      - ./kibana/config/privkey.pem:/usr/share/kibana/config/privkey.pem:ro,Z
      - ./kibana/config/fullchain.pem:/usr/share/kibana/config/fullchain.pem:ro,Z
      - ./kibana/config/chain.pem:/usr/share/kibana/config/chain.pem:ro,Z
      - ./kibana/config/isrgrootx1.pem:/usr/share/kibana/config/isrgrootx1.pem:ro,Z
      
5. volumesÎ°ú Ï†ÅÏùÄ Í≤ΩÎ°úÏóê ÌååÏùºÎì§ Î∞∞Ïπò
6. .env ÌååÏùºÏóêÏÑú ÎπÑÎ∞ÄÎ≤àÌò∏ ÏÑ§Ï†ï
```

- Ï£ºÏùòÏÇ¨Ìï≠

```
entrypoint.sh**,** lib.shÏóê Ïã§Ìñâ Í∂åÌïú Î∂ÄÏó¨

Î™®Îì† ÏÑ§Ï†ïÏùÑ Ìïú ÌõÑÏóê docker-compose setup Ïã§Ìñâ

ÏßÄÏ†ïÌïú Ï£ºÏÜåÏùò 5601Ìè¨Ìä∏Î°ú Ï†ëÏÜçÏãú Î°úÍ∑∏Ïù∏ ÌôîÎ©¥Ïù¥ Îì±Ïû•

idÎ•º Î≥ÄÍ≤ΩÌïòÏßÄ ÏïäÏïòÏúºÎ©¥ Í∏∞Î≥∏ idÎäî elastic
```

## Elasticsearch

- elasticsearch Ìè¥ÎçîÎ°ú ÏßÑÏûÖ ÌõÑ ÌååÏùº ÏàòÏ†ï DockerfileÏóê Ìï¥Îãπ Î™ÖÎ†πÏñ¥ Ï∂îÍ∞Ä

```
RUN elasticsearch-plugin install analysis-nori
```

- config Ìè¥ÎçîÎ°ú ÏßÑÏûÖ ÌõÑ elasticsearch.yml ÌååÏùºÏóê ÏàòÏ†ï(Í∏∞Ï°¥Ïóê Ï†ÅÌûå xpack ÏÑ§Ï†ï ÏÇ≠Ï†ú ÌõÑ Ìï¥Îãπ ÏÑ§Ï†ï Ï∂îÍ∞Ä)

```
xpack.license.self_generated.type: basic
xpack.security.enabled: true
xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.verification_mode: certificate
xpack.security.transport.ssl.key: /usr/share/elasticsearch/config/privkey.pem
xpack.security.transport.ssl.certificate: /usr/share/elasticsearch/config/fullchain.pem
xpack.security.transport.ssl.certificate_authorities: [ "/usr/share/elasticsearch/config/chain.pem" ]
xpack.security.http.ssl.enabled: true
xpack.security.http.ssl.key: /usr/share/elasticsearch/config/privkey.pem
xpack.security.http.ssl.certificate: /usr/share/elasticsearch/config/fullchain.pem
xpack.security.http.ssl.certificate_authorities: [ "/usr/share/elasticsearch/config/chain.pem" ]
```

## Logstash

- logstashÌè¥Îçî ÏïàÏóê config Ìè¥ÎçîÎ°ú ÏßÑÏûÖ ÌõÑ logstash.yml ÌååÏùºÏóê Ìï¥Îãπ ÏÑ§Ï†ï Ï∂îÍ∞Ä

```
xpack.monitoring.enabled: false
xpack.monitoring.elasticsearch.username: logstash_internal
xpack.monitoring.elasticsearch.password: ${LOGSTASH_INTERNAL_PASSWORD}
xpack.monitoring.elasticsearch.ssl.certificate_authority: /usr/share/logstash/config/chain.pem
xpack.monitoring.elasticsearch.ssl.certificate: /usr/share/logstash/config/fullchain.pem
xpack.monitoring.elasticsearch.ssl.key: /usr/share/logstash/config/privkey.pem
```

- Ïä§ÌîÑÎßÅ Î∂ÄÌä∏Ïùò build.gradleÏóê ÏùòÏ°¥ÏÑ± Ï∂îÍ∞Ä

```
// logstash
implementation 'net.logstash.logback:logstash-logback-encoder:7.4'
```

## Logstash

- kibana Ìè¥Îçî ÏïàÏóê config Ìè¥ÎçîÎ°ú ÏßÑÏûÖ ÌõÑ kibana.yml ÌååÏùºÏàòÏ†ï(elasticsearch.hosts ÏÇ≠Ï†ú ÌõÑ Ìï¥Îãπ ÏÑ§Ï†ï Ï∂îÍ∞Ä)

```
1.	ÏÑ§Ï†ï Ï∂îÍ∞Ä
		server.port: 5601
		server.publicBaseUrl: "ÎèÑÎ©îÏù∏ Ï£ºÏÜå!:5601"
		server.ssl.enabled: true
		server.ssl.certificate: /usr/share/kibana/config/fullchain.pem
		server.ssl.key: /usr/share/kibana/config/privkey.pem
		server.ssl.certificateAuthorities: [ "/usr/share/kibana/config/chain.pem" ]
		elasticsearch.hosts: [ https://elasticsearch:9200 ]
		elasticsearch.ssl.certificateAuthorities: [ "/usr/share/kibana/config/isrgrootx1.pem" ]
		elasticsearch.ssl.verificationMode: certificate

2.  xpack.fleet.agents.fleet_server.hosts: Ïóê ÏÜçÏÑ±ÏùÑ httpÏóêÏÑú httpsÎ°ú Î≥ÄÍ≤Ω

3.  xpack.fleet.outputsÏóê Ìï¥Îãπ ÏÑ§Ï†ï Ï∂îÍ∞Ä
    hosts: [ https://elasticsearch:9200 ]
    ssl.certificate_authorities: [ "/usr/share/kibana/config/chain.pem" ]
    ssl.certificate: "/usr/share/kibana/config/fullchain.pem"
    ssl.key: "/usr/share/kibana/config/privkey.pem"

```

## Sonarqube

- Î™ÖÎ†πÏñ¥Î°ú sonarqube Ïã§Ìñâ

```
docker run -d --name sonarqube -e SONAR_ES_BOOTSTRAP_CHECKS_DISABLE=true -p {Ìè¨Ìä∏Î≤àÌò∏}:9000 sonarqube:latest
```

- Ï†ëÏÜç ÌõÑ ÏÑ§Ï†ï

```
Í∏∞Î≥∏ id, pwÎäî admin
Ï†ëÏÜç ÌõÑ ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω
Í∑∏ ÌõÑÏóê ÌîÑÎ°úÏ†ùÌä∏ Îì±Î°ù
ÌîÑÎ°úÏ†ùÌä∏ ÌÇ§ ÏÉùÏÑ± ÌõÑ ÌîÑÎ°úÌïÑ ÌÅ¥Î¶≠ÏúºÎ°ú Ïù¥Îèô ÌõÑ securityÌÉ≠ÏúºÎ°ú Ïù¥Îèô

Project Analysis Token ÏÉùÏÑ± ÌõÑ Ï†ÄÏû•
```

- Ïä§ÌîÑÎßÅ Î∂ÄÌä∏Ïùò build.gradleÏóêÏÑú pluginÏóê Ìï¥Îãπ ÏÑ§Ï†ï Ï∂îÍ∞Ä

```
id "org.sonarqube" version "4.4.1.3373"
```

## Jenkins

- docker-compose.yml ÏûëÏÑ±

```
version: '3'

services:
  jenkins:
    image: jenkins/jenkins:latest-jdk17
    privileged: true
    user: root
    ports:
      - Ìè¨Ìä∏Î≤àÌò∏!!!:8080
    container_name: Ïª®ÌÖåÏù¥ÎÑàÏù¥Î¶Ñ!!!!
    volumes:
      - ./jenkins_home:/var/jenkins_home
    restart: unless-stopped
    command: bash -c "apt-get update && apt-get install -y docker.io && jenkins.sh"
```

- docker-compose up -d Ïã§Ìñâ ÌõÑ

```
docker logs Ïª®ÌÖåÏù¥ÎÑàÏù¥Î¶Ñ!!! Ïã§Ìñâ Í∑∏ ÏïàÏóêÏÑú ÌÜ†ÌÅ∞Ïù¥ Îì±Ïû•
ÏßÄÏ†ïÎêú Ìè¨Ìä∏Î°ú Ï†ëÏÜç ÌõÑ ÌÜ†ÌÅ∞ÏùÑ ÏûÖÎ†• ÌïòÎ©¥ Í∏∞Î≥∏ ÏÑ§Ï†ï ÌéòÏù¥ÏßÄÍ∞Ä Îì±Ïû•
idÏôÄ password ÏÑ§Ï†ï ÌõÑ Í∏∞Î≥∏ ÌîåÎü¨Í∑∏Ïù∏ Îã§Ïö¥Î°úÎìú ÏßÑÌñâ
```

- Ï∂îÍ∞Ä ÌîåÎü¨Í∑∏Ïù∏ ÏÑ§Ïπò

```
SSH Agent

Docker
Docker Commons
Docker Pipeline
Docker API

Generic Webhook Trigger

GitLab
GitLab API,
GitLab Authentication

NodeJS

Mattermost Notification
```

- ÏÉàÎ°úÏö¥ itemÏúºÎ°ú back front ÏïÑÏù¥ÌÖú ÏÉùÏÑ±

```
1. ÏÉùÏÑ± ÌõÑ Build TriggersÏïàÏóê Build when a change is pushed to GitLab. GitLab webhook URL: Ï≤¥ÌÅ¨ ÌõÑ URL Î≥µÏÇ¨
2. push EventsÏôÄ Opened Merge Request Events Ï≤¥ÌÅ¨
3. Í≥†Í∏âÏùÑ ÏÑ†ÌÉù ÌõÑ Secret token Generate Ïã§Ìñâ ÌõÑ Î≥µÏÇ¨
4. ÍπÉÎû© Ï†ëÏÜç ÌõÑ ÌîÑÎ°úÏ†ùÌä∏ ÏÑ†ÌÉù ‚Üí Settings ‚Üí Webhooks Ï†ëÏÜç
5. add new webhook ÏÑ†ÌÉù ÌõÑ jeninsÏóêÏÑú Î≥µÏÇ¨Ìïú URL ÏûÖÎ†•
6. Secret tokenÏóê Î≥µÏÇ¨ÌñàÎçò Secret token ÏûÖÎ†•
7. Ìä∏Î¶¨Í±∞Ïóê push events ÏÑ†ÌÉù ÌõÑ Ï†ÄÏû•
```

## Docker Hub Setting

- Docker Hub Token Î∞úÍ∏â

```
1. Ïö∞Ï∏° ÏÉÅÎã®Ïùò Sign in Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Î°úÍ∑∏Ïù∏
2. Ïö∞Ï∏° ÏÉÅÎã®Ïùò Í≥ÑÏ†ïÎ™ÖÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Account Settings ÌÅ¥Î¶≠
3. New Access Token - Read,Write,Delete Í∂åÌïúÏùÑ Í∞ÄÏßÑ Token Î∞úÍ∏â
4. Token Í∞í Ï†ÄÏû•
```

- Docker Hub Repository ÏÉùÏÑ±

```
1. ÏÉÅÎã®Ïùò Repositories - Create repository ÌÅ¥Î¶≠
2. Visibility ÏßÄÏ†ï ÌõÑ Create ÌÅ¥Î¶≠
```

## Jenkins Pipeline Setting

- ÌîåÎü¨Í∑∏Ïù∏ ÏÑ§Ïπò
    - Jenkins Í¥ÄÎ¶¨ - Plugins - Available Plugins - ÏÑ†ÌÉù ÌõÑ Install without restart ÌÅ¥Î¶≠

```
SSH Agent

Docker
Docker Commons
Docker Pipeline
Docker API

Generic Webhook Trigger

GitLab
GitLab API,
GitLab Authentication

NodeJS

Mattermost Notification
```

- Docker Hub Credential Îì±Î°ù
    - Jenkins Í¥ÄÎ¶¨ - Credentials - global - Add Credentials - Create

```
Kind: Username with password
Username: Docker HubÏóêÏÑú ÏÇ¨Ïö©ÌïòÎäî ID
Password: Docker HubÏóêÏÑú ÏÇ¨Ïö©ÌïòÎäî Token Í∞í
ID: CredentialÏóê ÎåÄÌïú Î≥ÑÏπ≠
```

- GitLab Credential Îì±Î°ù
    - Jenkins Í¥ÄÎ¶¨ - Credentials - global - Add Credentials - Create

```
Kind: Username with password
Username: GitLab Í≥ÑÏ†ï ÏïÑÏù¥Îîî ÏûÖÎ†•
Password: GitLab Í≥ÑÏ†ï ÎπÑÎ∞ÄÎ≤àÌò∏
ID: CredentialÏóê ÎåÄÌïú Î≥ÑÏπ≠
```

- Ubuntu Credential Îì±Î°ù
    - Jenkins Í¥ÄÎ¶¨ - Plugins - Available Plugins - SSH Agent
    - Jenkins Í¥ÄÎ¶¨ - Credentials - global - Add Credentials - Create

```
Kind: Username with private key
ID: CredentialÏóê ÎåÄÌïú Î≥ÑÏπ≠
Username: SSH ÏõêÍ≤© ÏÑúÎ≤Ñ Ìò∏Ïä§Ìä∏ÏóêÏÑú ÏÇ¨Ïö©ÌïòÎäî Í≥ÑÏ†ïÎ™Ö(ubuntu)
====> Enter directly - Add ÌÅ¥Î¶≠
.pem ÌÇ§Ïùò ÎÇ¥Ïö©ÏùÑ Î©îÎ™®Ïû•ÏùÑ ÏùΩÏñ¥ Î≥µÏÇ¨ ÌõÑ KeyÏóê Î∂ôÏó¨ÎÑ£ÏùÄ ÌõÑ Create
```

- logback Îì±Î°ù

```
Kind: Secret file
ID: CredentialÏóê ÎåÄÌïú Î≥ÑÏπ≠
file : logback-spring.xml ÏÑ†ÌÉù ÌõÑ create
```

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>
    <include resource="org/springframework/boot/logging/logback/console-appender.xml" />
    <springProperty scope="context" name="application_name" source="spring.application.name"/>

    <appender name="LOGSTASH" class="net.logstash.logback.appender.LogstashTcpSocketAppender">
        <destination>{Î°úÍ∑∏ Ïä§ÌÉúÏãú Ï£ºÏÜå}:{Î°úÍ∑∏ Ïä§ÌÉúÏãú Ìè¨Ìä∏}</destination>
        <encoder class="net.logstash.logback.encoder.LogstashEncoder">
            <customFields>{"app_name":"${application_name}"}</customFields>
            <includeMdcKeyName>METHOD</includeMdcKeyName>
            <includeMdcKeyName>URI</includeMdcKeyName>
            <includeMdcKeyName>PARAMS</includeMdcKeyName>
            <fieldNames>
                <timestamp>timestamp</timestamp>
                <message>message</message>
                <thread>thread</thread>
                <level>level</level>
                <stackTrace>stack_trace</stackTrace>
            </fieldNames>
            <stackTraceConfiguration>
                <throwableConverter class="net.logstash.logback.stacktrace.ShortenedThrowableConverter">
                    <maxDepthPerThrowable>30</maxDepthPerThrowable>
                    <maxLength>2048</maxLength>
                    <shortenedClassNameLength>20</shortenedClassNameLength>
                    <exclude>^sun\.reflect\..*\.invoke</exclude>
                    <exclude>^net\.sf\.cglib\.proxy\.MethodProxy\.invoke</exclude>
                    <rootCauseFirst>true</rootCauseFirst>
                </throwableConverter>
            </stackTraceConfiguration>
        </encoder>
    </appender>

    <root level="INFO">
        <appender-ref ref="LOGSTASH"/>
        <appender-ref ref="CONSOLE"/>
    </root>
</configuration>
```

- .env Îì±Î°ù

```
Kind: Secret file
ID: CredentialÏóê ÎåÄÌïú Î≥ÑÏπ≠
file : .env ÏÑ†ÌÉù ÌõÑ create
```

```
VITE_NAVER_CLIENT_KEY = {ÎÑ§Ïù¥Î≤Ñ ÏßÄÎèÑ ÏãúÌÅ¨Î¶ø ÌÇ§}
```

- localSonar Îì±Î°ù

```
Kind: Secret text
ID: CredentialÏóê ÎåÄÌïú Î≥ÑÏπ≠
secret: local sonarqube url ÏûëÏÑ± ÌõÑ create
```

- localSonarUrl Îì±Î°ù

```
Kind: Secret text
ID: CredentialÏóê ÎåÄÌïú Î≥ÑÏπ≠
secret: local sonarqube url ÏûëÏÑ± ÌõÑ create
```

- localSonarKey Îì±Î°ù

```
Kind: Secret text
ID: CredentialÏóê ÎåÄÌïú Î≥ÑÏπ≠
secret: local sonarqube url ÏûëÏÑ± ÌõÑ create
```

- Gradle Ï∂îÍ∞Ä
    - Jenkins Í¥ÄÎ¶¨ - Tools

```
name: gradle
Install automatically Ï≤¥ÌÅ¨
ÌîÑÎ°úÏ†ùÌä∏ Î≤ÑÏ†ÑÏóê ÎßûÎäî Gradle ÏÑ†ÌÉù ÌõÑ Save
```

- Node.js Ï∂îÍ∞Ä
    - Jenkins Í¥ÄÎ¶¨ - Tools

```
Name: Node.js ÌôòÍ≤ΩÏóê ÎåÄÌïú Ïù¥Î¶Ñ
Version: ÎπåÎìúÌïòÎ†§Îäî Node.js Î≤ÑÏ†Ñ ÏÑ†ÌÉù ÌõÑ Save
```

- Node.js ÎπåÎìú Ïãú ÏÇ¨Ïö©ÌïòÎäî ÌôòÍ≤ΩÎ≥ÄÏàò ÏÑ§Ï†ï
    - Jenkins Í¥ÄÎ¶¨ -System
    - Global properties

```
1. Environment variables Ï≤¥ÌÅ¨
2, CI, false ÌôòÍ≤ΩÎ≥ÄÏàò Ï∂îÍ∞Ä - Ï†ÄÏû•
```

# üîã S3 Setting

### IAM ÏÑ§Ï†ï

- ÏÇ¨Ïö©Ïûê ÏÉùÏÑ±

```
1. ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ ÏßÄÏ†ï
2. Í∂åÌïú ÏòµÏÖòÏóêÏÑú ÏßÅÏ†ë Ï†ïÏ±Ö Ïó∞Í≤∞
3. Í≤ÄÏÉâ Ï∞ΩÏóê AmazonS3FullAccess Ï≤¥ÌÅ¨
4. ÏÇ¨Ïö©Ïûê ÏÉùÏÑ±
```

- Ïï°ÏÑ∏Ïä§ ÌÇ§ Î∞úÍ∏â

```
1. ÏÉùÏÑ±Ìïú ÏÇ¨Ïö©ÏûêÏÑ†ÌÉù
2. Ïï°ÏÑ∏Ïä§ ÌÇ§ ÎßåÎì§Í∏∞ ÏÑ†ÌÉù
3. Í∏∞ÌÉÄ ÏÑ†ÌÉù
4. Ïï°ÏÑ∏Ïä§ ÌÇ§ ÏÉùÏÑ±
5. Ïï°ÏÑ∏Ïä§ ÌÇ§ÏôÄ ÎπÑÎ∞Ä Ïï°ÏÑ∏Ïä§ ÌÇ§ Ï†ÄÏû•
```

- S3 Î≤ÑÌÇ∑ ÏÉùÏÑ±

```
1. ACL ÌôúÏÑ±Ìôî
2. Î™®Îì† ÌçºÎ∏îÎ¶≠ Ïï°ÏÑ∏Ïä§ Ï∞®Îã® Ìï¥Ï†ú
3. Ï£ºÏùòÏÇ¨Ìï≠ Ï≤¥ÌÅ¨
4. Î≤ÑÌÇ∑ ÎßåÎì§Í∏∞
```

- ACL ÏÑ§Ï†ï

```
1. ÏÉùÏÑ±Îêú Î≤ÑÌÇ∑ Ïò§Ìîà
2. Í∂åÌïú Î™©Î°ùÏúºÎ°ú Ïù¥Îèô
3. ACL(Ïï°ÏÑ∏Ïä§ Ï†úÏñ¥ Î™©Î°ù) Ìé∏Ïßë
4. Î™®Îì† ÏÇ¨Îûå(ÌçºÎ∏îÎ¶≠ ÏóëÏÑ∏Ïä§)ÏóêÏÑú ÏùΩÍ∏∞Ïóê Ï≤¥ÌÅ¨
5. Ï£ºÏùòÏÇ¨Ìï≠ Ï≤¥ÌÅ¨
6. Î≥ÄÍ≤Ω ÏÇ¨Ìï≠ Ï†ÄÏû•
```

# üíΩ Data Import

```
1. Mysql Workbench Ï†ëÏÜç
2. Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ÏôÄ Ïó∞Í≤∞
3. ÏÉÅÎã®Ïùò server - Data Import ÏÑ†ÌÉù
4. Import from Self-Contained File ÏÑ†ÌÉù ÌõÑ sql ÌååÏùº ÏÑ†ÌÉù
5. Default Target SchemaÏóêÏÑú ÏÇ¨Ïö©Ìï† Schema ÏÑ†ÌÉù
6. Start Import ÏÑ†ÌÉù
```

# üé¨ Deployment Command

## Pipeline (Back)

```bash
def getNextVersion(currentVersion) {
    return currentVersion == 'Ìè¨Ìä∏1Î≤à' ? 'Ìè¨Ìä∏2Î≤à' : 'Ìè¨Ìä∏1Î≤à'
}

pipeline {
    agent any
    
    environment {
        imageName = "Ïù¥ÎØ∏ÏßÄ Ïù¥Î¶Ñ"
        containerName= "Ïª®ÌÖåÏù¥ÎÑà Ïù¥Î¶Ñ"
        branch="Î∏åÎûúÏπò Ïù¥Î¶Ñ"
        DOCKERHUB_CREDENTIALS = credentials('docker credentials Ïù¥Î¶Ñ')
        gitUrl=credentials("gitUrl credentials Ïù¥Î¶Ñ")
        
        configBranch="config ÏÑ§Ï†ïÏù¥ ÏûàÎäî Î∏åÎûúÏπò Ïù¥Î¶Ñ"

        sonarUrl=credentials("localSonarUrl credentials Ïù¥Î¶Ñ")
        sonarKey=credentials("localSonarKey credentials Ïù¥Î¶Ñ")

        releaseServerAccount = 'server user Ïù¥Î¶Ñ'
        releaseServerUri = 'server URL'
    }
    stages {
        stage('Set Environment Variable') {
            steps {
                script {
                    sshagent(credentials: ['EC2']) {
                        def currentVersion = sh(script: "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo docker ps --filter \"name=$containerName\" --format \"{{.Names}}\" | awk -F\"-\" \"{print \\\$2}\"'", returnStdout: true).trim()
                        env.CURRENT_VERSION = currentVersion
                        env.NEXT_VERION = getNextVersion(currentVersion)
                    }
                }
            }
        }
        stage('clone'){
            steps{
                git branch: "$branch", 
                changelog: false, 
                credentialsId: 'git', 
                poll: false, 
                url: "$gitUrl"
            }
        }
        
        stage('Git Switch') {
            steps {
                sh "git switch '$configBranch'"
            }
        }
        stage('Pull') {
            steps {
                script {
                    git branch: "$configBranch",
                        credentialsId: 'git',
                        url: "$gitUrl"
                }
            }
        }
        stage('Jar Build') {
            steps {
                dir ('backend/githerbs') {
                    sh "git switch '${branch}'"
                    
                    sh "git show '${configBranch}:backend/githerbs/src/main/resources/application.yml' > './src/main/resources/application.yml'"
                    
                    withCredentials([file(credentialsId: 'logback', variable: 'logback')]) {
                        sh "cp ${logback} ./src/main/resources/logback.xml"
                    }
                    
                    sh 'chmod +x ./gradlew'
                    sh './gradlew clean bootJar -x test'
                    sh './gradlew build -x test'
                }
            }
        }
        stage('Build and Push Docker Image') {
            steps {
                script {
                    sshagent(credentials: ['EC2']) {
                        dir ('backend/githerbs') {
                            def app = docker.build("${imageName}:${env.NEXT_VERION}")
                            docker.withRegistry('', 'docker') {
                                app.push()
                            }
                        }
                    }
                }
            }
        }
        stage('DockerHub Pull and Run') {
            steps {
                sshagent(credentials: ['EC2']) {
                    script {
                        sh "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo docker login --username $DOCKERHUB_CREDENTIALS_USR --password $DOCKERHUB_CREDENTIALS_PSW'"
                        sh "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo docker pull ${imageName}:${env.NEXT_VERION}'"
                        sh "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo docker run --name $containerName-${env.NEXT_VERION} -p ${env.NEXT_VERION}:8080 -e TZ=Asia/Seoul -d $imageName:${env.NEXT_VERION}'"
                    }
                }
            }
        }
        stage('Health Check') {
            steps {
                sshagent(credentials: ['EC2']) {
                script {
                    def healthCheckUrl = "http://${releaseServerUri}:${env.NEXT_VERION}/api/actuator/health"
                    sleep(time:14,unit:"SECONDS")
                    def healthCheckResult = sh(script: "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri curl -s --connect-timeout 5 ${healthCheckUrl} | grep UP | wc -l", returnStdout: true).trim()
                    print "${healthCheckResult}"
                    
                    if (healthCheckResult.toString() == "1") {
                        println "Health check passed. Application is running successfully."
                    } else {
                        println "Health check failed. Application is not running properly."
                        sh "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo docker rm -f $containerName-${env.NEXT_VERION}'"
                        sh "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo docker rmi $imageName:${env.NEXT_VERION}'"
                        error "Health check failed. Pipeline aborted."
                        }
                    }
                }
            }
        }
        stage('Switch to New Version') {
            steps {
                sshagent(credentials: ['EC2']) {
                    script {
                        sh "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo sed -i -e s/${env.CURRENT_VERSION}/${env.NEXT_VERION}/ /etc/nginx/conf.d/service-url.inc'"
                        sh "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo nginx -s reload'"
                    }
                }
            }
        }
        stage('SonarQube Analysis') {
            steps {
                dir ('backend/githerbs') {
                    script {
                        withCredentials([string(credentialsId: 'localSonar', variable: 'SONAR_LOGIN_KEY')]) {
                            sh 'chmod +x ./gradlew'
                            sh "./gradlew sonarqube -Dsonar.projectKey=$sonarKey -Dsonar.login=${SONAR_LOGIN_KEY} -Dsonar.host.url=$sonarUrl"
                        }
                        
                    }
                }
            }
        }
        stage('Cleanup') {
            steps {
                sshagent(credentials: ['EC2']) {
                    script {
                        sh "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo docker rm -f $containerName-${env.CURRENT_VERSION}'"
                        sh "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo docker rmi $imageName:${env.CURRENT_VERSION}'"
                    }
                }
            }
        }
    }
    post {
        success {
        	script {
                def Author_ID = sh(script: "git show -s --pretty=%an", returnStdout: true).trim()
                def Author_Name = sh(script: "git show -s --pretty=%ae", returnStdout: true).trim()
                mattermostSend (color: 'good', 
                message: "back ÎπåÎìú ÏÑ±Í≥µ: ${env.JOB_NAME} #${env.BUILD_NUMBER} by ${Author_ID}(${Author_Name})\n[<${env.BUILD_URL}|Jenkins(backend)>]"
                )
            }
        }
        failure {
        	script {
                def Author_ID = sh(script: "git show -s --pretty=%an", returnStdout: true).trim()
                def Author_Name = sh(script: "git show -s --pretty=%ae", returnStdout: true).trim()
                mattermostSend (color: 'danger', 
                message: "back ÎπåÎìú Ïã§Ìå®: ${env.JOB_NAME} #${env.BUILD_NUMBER} by ${Author_ID}(${Author_Name})\n[<${env.BUILD_URL}|Jenkins(backend)>]"
                )
            }
        }
    }
}
```

## Pipeline (Front)

```bash
pipeline {
    agent any
    
    environment {
        imageName = "Ïù¥ÎØ∏ÏßÄ Ïù¥Î¶Ñ"
        containerName= "Ïª®ÌÖåÏù¥ÎÑà Ïù¥Î¶Ñ"
        branch="Î∏åÎûúÏπò Ïù¥Î¶Ñ"
        DOCKERHUB_CREDENTIALS = credentials('docker credentials Ïù¥Î¶Ñ')
        gitUrl=credentials("gitUrl credentials Ïù¥Î¶Ñ")

        releaseServerAccount = 'server user Ïù¥Î¶Ñ'
        releaseServerUri = 'server URL'
        releasePort = 'Î∞∞Ìè¨Ìï† Ìè¨Ìä∏'
    }

    stages {
        stage('clone'){
                steps{
                    git branch: "$branch", 
                    changelog: false, 
                    credentialsId: 'git', 
                    poll: false, 
                    url: "$gitUrl"
                }
        }
        stage('Npm Build') {
            steps {
                dir ('frontend') {
                    withCredentials([file(credentialsId: 'envFile', variable: 'ENV_FILE')]) {
                        sh "cp ${ENV_FILE} ./.env"
                    }
                    
                    nodejs('node') {
                        sh 'npm install'
                        sh 'NODE_OPTIONS=--max-old-space-size=2048 npm run build'
                    }
                }
            }
        }
        stage('Build and Push Docker Image') {
            steps {
                 dir ('frontend') {
                     script {
                         def app = docker.build("${imageName}:80")
                         docker.withRegistry('', 'docker') {
                            app.push()
                        }
                    }
                }
            }
        }
        stage('Docker Image Delete') {
            steps {
                sshagent(credentials: ['EC2']) {
                    sh "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo docker rm -f $containerName'"
                    sh "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo docker rmi $imageName:80'"
                }
            }
        }
        stage('DockerHub Pull') {
            steps {
                sshagent(credentials: ['EC2']) {
                    sh "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo docker login --username $DOCKERHUB_CREDENTIALS_USR --password $DOCKERHUB_CREDENTIALS_PSW'"
                    sh "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo docker pull $imageName:80'"
                }
            }
        }
        stage('Service Start') {
            steps {
                sshagent(credentials: ['EC2']) {
                    sh "ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri 'sudo docker run --name $containerName -p $releasePort:80 -d $imageName:80'"
                }
            }
        }
    }
    post {
        success {
        	script {
                def Author_ID = sh(script: "git show -s --pretty=%an", returnStdout: true).trim()
                def Author_Name = sh(script: "git show -s --pretty=%ae", returnStdout: true).trim()
                mattermostSend (color: 'good', 
                message: "ftont ÎπåÎìú ÏÑ±Í≥µ: ${env.JOB_NAME} #${env.BUILD_NUMBER} by ${Author_ID}(${Author_Name})\n[<${env.BUILD_URL}|Jenkins(frontend)>]"
                )
            }
        }
        failure {
        	script {
                def Author_ID = sh(script: "git show -s --pretty=%an", returnStdout: true).trim()
                def Author_Name = sh(script: "git show -s --pretty=%ae", returnStdout: true).trim()
                mattermostSend (color: 'danger', 
                message: "ftont ÎπåÎìú Ïã§Ìå®: ${env.JOB_NAME} #${env.BUILD_NUMBER} by ${Author_ID}(${Author_Name})\n[<${env.BUILD_URL}|Jenkins(frontend)>]"
                )
            }
        }
    }
} 
```